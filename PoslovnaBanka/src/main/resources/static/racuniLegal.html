<html>
<head>
	<script src="scripts/jquery-3.2.1.min.js"></script>
	<script src="scripts/tether.min.js"></script>
	<script src="scripts/bootstrap.min.js"></script>
	<script src="scripts/functions.js"></script>
	<link rel="stylesheet" type="text/css" href="stylesheets/design.css">
	<link rel="stylesheet" href="stylesheets/bootstrap.min.css">
	<meta charset="UTF-8">
	<title>LegalEntitiesAccounts</title>
</head>
<script>
$(document).ready(
		function() {
			
			var queryString = decodeURIComponent(window.location.search);
			queryString = queryString.substring(8);
			
			$.ajax({
				url : "http://localhost:8083/legalEntity/leClient/"+ queryString +"/getBankAccounts"
			}).then(
					function(data) {
						for (i = 0; i < data.length; i++) {
							newRow = 
								"<tr>"
									+ "<td class=\"id\">" + data[i].id + "</td>"
									+ "<td class=\"broj\">" + data[i].accountNumber + "</td>"
									+ "<td class=\"datum\">" + data[i].openingDate + "</td>"
									+ "<td class=\"vazeci\">" + data[i].active + "</td>"
									+ "<td class=\"sredstva\">" + data[i].money + "</td>"
									+ "<td><a class=\"deactivate\" data-toggle=\"modal\" data-target=\"#deactivateModal\" href='/legalEntity/leClient/account/deactivate/" + data[i].id + "'>" 
									+ "<img src='images/remove.gif'/></a></td>"
								+ "</tr>"
							$("#dataTable").append(newRow)
						}
					});
			
			$("#deactivate-btn").click(function(event){
				event.preventDefault();
				formData = $("#deactivateForm [name='accountNumber']").val();

				$.ajax({
					url: $("#deactivateForm [name='url']").val(),
					type: "POST",
					data: formData,
					contentType: "application/json",
					success: function(data) {
						if(data != null) {
							var qs = decodeURIComponent(window.location.search);
		        			window.location.href = "racuniIndidivual.html" + qs;
						} else {
							alert('Ne postoji takav broj racuna!');
						}
					}
				});
			});
});

$(document).on("click", ".deactivate", function(event){
	event.preventDefault();
	var myurl = $(this).attr("href");
	$("#deactivateModal [name='url']").val(myurl);
});
</script>
<body>
	<!-- Dialog za zatvaranje racuna -->
	<div class="modal" id="deactivateModal" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Unesite broj racuna na koji ce se preneti sva sredstva</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<form id="deactivateForm">
					<div class="modal-body">
						<p>
							<input type="hidden" name="url" id="url" disabled/> 
							<input class="form-control" type="text" name="accountNumber" id="accountNumber" placeholder="Broj racuna" required="true"/>
						</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Zatvori</button>
						<button type="button" class="btn btn-primary" id="deactivate-btn">Potvrdi</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	
	<h1>LegalEntities Accounts</h1>
	<table border = "1" id="dataTable" class="table">
			<tr>
				<th>Id</th>
				<th>Broj racuna</th>
				<th>Datum otvaranja</th>
				<th>Vazeci</th>
				<th>Sredstva</th>
				<th>Deactivate</th>
			</tr>
	</table>
	
</body>
</html>