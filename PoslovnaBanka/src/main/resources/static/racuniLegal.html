<html>
<head>
	<script src="scripts/jquery-3.2.1.min.js"></script>
	<script src="scripts/tether.min.js"></script>
	<script src="scripts/bootstrap.min.js"></script>
	<script src="scripts/functions.js"></script>
	<link rel="stylesheet" type="text/css" href="stylesheets/design.css">
	<link rel="stylesheet" href="stylesheets/bootstrap.min.css">
	<meta charset="UTF-8">
	<title>LegalEntitiesAccounts</title>
</head>
<script>
$(document).ready(
		function() {
			
			var queryString = decodeURIComponent(window.location.search);
			queryString = queryString.substring(8);
			
			$.ajax({
				url : "http://localhost:8083/legalEntity/leClient/"+ queryString +"/getBankAccounts"
			}).then(
					function(data) {
						for (i = 0; i < data.length; i++) {
							if(data[i].active){
							newRow = 
								"<tr>"
									+ "<td class=\"id\">" + data[i].id + "</td>"
									+ "<td class=\"broj\">" + data[i].accountNumber + "</td>"
									+ "<td class=\"datum\">" + data[i].openingDate + "</td>"
									+ "<td class=\"vazeci\">" + data[i].active + "</td>"
									+ "<td class=\"sredstva\">" + data[i].money + "</td>"
									+ "<td><a class=\"deactivate\" href='/legalEntity/leClient/account/deactivate/" + data[i].id + "'>" 
									+ "<img src='images/remove.gif'/></a></td>"
								+ "</tr>"
							$("#dataTable").append(newRow)
							}
						}
					});
		});
		
$(document).on("click", ".deactivate", function(event){
	//ne salji get zahtev
		event.preventDefault(); 
	
		var url = $(this).attr("href")
		//red koji se treba izbrisati ako je brisanje na serveru bilo uspesno
		$.ajax({
        	url: url,
        	type: "GET",
    		contentType:"application/json",
    		dataType:"json",
        	success: function(data){
        		if(data != null) {
        			var qs = decodeURIComponent(window.location.search);
        			window.location.href = "racuniLegal.html" + qs;
    				
    			}
    		},
    		error: function(jqxhr,textStatus,errorThrown) {
    			alert(errorThrown);
    		}	 
				
		});
});
</script>
<body>
	<h1>LegalEntities Accounts</h1>
	<table border = "1" id="dataTable" class="table">
			<tr>
				<th>Id</th>
				<th>Broj racuna</th>
				<th>Datum otvaranja</th>
				<th>Vazeci</th>
				<th>Sredstva</th>
				<th>Deactivate</th>
			</tr>
	</table>
	
</body>
</html>